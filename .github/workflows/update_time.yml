name: Auto Update time in exp31Jan.txt

on:
  schedule:
    - cron: "*/5 * * * *"   # tiap 5 menit
  workflow_dispatch:        # bisa dijalankan manual

permissions:
  contents: write

jobs:
  update-time:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Update time field in exp31Jan.txt
        run: |
          NOW=$(date -u +%s)
          FILE="exp31Jan.txt"

          # kalau file belum ada, buat default
          if [ ! -f "$FILE" ]; then
            echo "status=on" > "$FILE"
            echo "expire=1769878799" >> "$FILE"
            echo "time=$NOW" >> "$FILE"
          else
            # replace time=
            if grep -q "^time=" "$FILE"; then
              sed -i "s/^time=.*/time=$NOW/" "$FILE"
            else
              echo "time=$NOW" >> "$FILE"
            fi

            # pastikan status & expire ada (kalau hilang)
            if ! grep -q "^status=" "$FILE"; then
              echo "status=on" >> "$FILE"
            fi
            if ! grep -q "^expire=" "$FILE"; then
              echo "expire=1769878799" >> "$FILE"
            fi
          fi

          echo "âœ… Updated $FILE time=$NOW"
          cat "$FILE"

      - name: Commit & push changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

          git add exp31Jan.txt

          # kalau tidak ada perubahan, stop
          git diff --cached --quiet && exit 0

          git commit -m "auto: update time (exp31Jan)"
          git push
